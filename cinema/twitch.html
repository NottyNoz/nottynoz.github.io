<html>
<input style="position:absolute;opacity:0;"></input>
<body style="margin:0px;background-color:black;overflow:hidden;">
	<div id="player" style="width:100%;height:200%;position:absolute;top:-50%;"></div>
</body>
<script src="https://player.twitch.tv/js/embed/v1.js"></script>
<script type="text/javascript">
	const urlParams = new URLSearchParams(window.location.search);
	var key = urlParams.get("v");

	const trapInput = document.querySelector("input");
	setInterval(function(){if(player_ready)trapInput.focus()}, 10); // required to recapture key inputs for onkeydown

	var player_ready = false;
	var volume = parseFloat(urlParams.get("vol"));
	var duration;
	var player;
	
	function think() {
		if (player_ready) {
            player.getQualities().forEach(function(quality){
                if (quality.name.includes("source")){
                    player.setQuality(quality.name);
                }
            });
			player.setVolume(volume/100);
			if (volume > 0) player.setMuted(false);
		}
	}
	setInterval(think, 200);
			
	window.onkeydown = function(e){
		var code = e.keyCode ? e.keyCode : e.which;
		
		if (code >= 240 && code <= 340){ // 0xF0
			volume = code - 240;
		}
	};

	player = new Twitch.Player("player", {
	    channel: key,
	    parent: [window.location.hostname]
	});
	player._iframe.style.width = "100%";
	player._iframe.style.height = "100%";

	player.addEventListener(Twitch.Player.PLAYING, function(){
	    player_ready = true;
	});
</script>
</html>